System.register(["jimu-core","jimu-arcgis","esri/Graphic"],(function(e,t){var r={},o={},i={};return{setters:[function(e){r.React=e.React,r.jsx=e.jsx},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.default=e.default}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=i},244:e=>{"use strict";e.exports=r},686:e=>{"use strict";e.exports=o}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var s={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(s),n.d(s,{__set_webpack_public_path__:()=>a,default:()=>i});var e=n(244),t=n(686),r=n(89),o=function(e,t,r,o){return new(r||(r=Promise))((function(i,n){function s(e){try{c(o.next(e))}catch(e){n(e)}}function a(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};function i(i){var n;console.log("\u{1f9e9} Custom Popup Widget Loaded!");const[s,a]=e.React.useState(null),[c,l]=e.React.useState(null),u=e.React.useRef(null),d=e.React.useCallback((()=>{if(u.current){try{u.current.remove()}catch(e){}u.current=null}}),[]);e.React.useEffect((()=>()=>{d()}),[d]),e.React.useEffect((()=>{const e=e=>{try{const t=(null==e?void 0:e.detail)||null;if(!t)return;if(l({attributes:t.attributes,geometry:t.geometry,layerTitle:t.layerTitle||"Organization"}),s&&t.geometry)try{const e=s.view,o=new r.default({geometry:t.geometry,symbol:{type:"simple-marker",color:[0,120,215,.6],outline:{color:[255,255,255],width:2}}});e.graphics.removeAll(),e.graphics.add(o),e.goTo({target:t.geometry,zoom:14}).catch((()=>{}))}catch(e){}}catch(e){}};return window.addEventListener("open-custom-popup",e),()=>{window.removeEventListener("open-custom-popup",e)}}),[s]),e.React.useEffect((()=>{const e=()=>{var e;try{l(null),(null===(e=null==s?void 0:s.view)||void 0===e?void 0:e.graphics)&&s.view.graphics.removeAll()}catch(e){}};return window.addEventListener("clear-custom-selection",e),()=>{window.removeEventListener("clear-custom-selection",e)}}),[s]);const p=e=>{if(!e)return{isOpen:!1,text:"Unknown hours"};const t=e=>{var t;const r=e.trim().match(/(\d{1,2})(?::(\d{1,2}))?\s*(am|pm)?/i);if(!r)return null;let o=parseInt(r[1],10);const i=parseInt(r[2]||"0",10),n=null===(t=r[3])||void 0===t?void 0:t.toLowerCase();return"pm"===n&&o<12&&(o+=12),"am"===n&&12===o&&(o=0),60*o+i},r=new Date,o=r.getDay(),i=60*r.getHours()+r.getMinutes();if(/closed\s+(on\s+)?(weekends?|sundays?|saturdays?)/i.test(e)&&(0===o||6===o))return{isOpen:!1,text:"Closed today (weekends)"};if(/by appointment/i.test(e))return{isOpen:!1,text:"By appointment only"};let n=!1;if(n=/(mon(day)?\s*(to|\-)\s*fri(day)?)/i.test(e)?o>=1&&o<=5:!/(sat(urday)?|sun(day)?)/i.test(e)||(0===o||6===o),!n)return{isOpen:!1,text:"Closed today"};const s=e.match(/(\d{1,2}(:\d{1,2})?\s*(am|pm)?)\s*(to|\u2013|-)\s*(\d{1,2}(:\d{1,2})?\s*(am|pm)?)/i);if(!s)return{isOpen:!1,text:"Unknown hours"};const a=t(s[1]),c=t(s[5]);if(null==a||null==c)return{isOpen:!1,text:"Unknown hours"};const l=i>=a&&i<=c;return{isOpen:l,text:l?`Open \u2022 Closes at ${s[5].toUpperCase()}`:`Closed \u2022 Opens at ${s[1].toUpperCase()}`}},f=null===(n=i.config)||void 0===n?void 0:n.sourceMapWidgetId;return(0,e.jsx)("div",{className:"p-3 space-y-3",css:{fontFamily:"Segoe UI, sans-serif",lineHeight:1.4,color:"#333",height:"100%",display:"flex",flexDirection:"column"}},f&&(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:f,onActiveViewChange:e=>{if(console.log("\u{1f517} Active view change triggered:",e),d(),!e)return;a(e);const t=e.view;t.when((()=>{console.log("\u2705 MapView is ready, attaching click handler..."),u.current=t.on("click",(e=>o(this,void 0,void 0,(function*(){var o,i;console.log("\u{1f5b1}\ufe0f Map clicked at:",e.mapPoint);try{const n=yield t.hitTest(e);console.log("\u{1f3af} HitTest results:",(null===(o=n.results)||void 0===o?void 0:o.length)||0);const s=n.results.find((e=>{var t;return e.graphic&&"feature"===(null===(t=e.graphic.layer)||void 0===t?void 0:t.type)}));if(!s)return console.log("\u274c No feature layer found at click point."),void l(null);const a=s.graphic.layer,c=s.graphic;console.log("\u2705 Target layer feature found:"),console.log("   Layer:",a.title),console.log("   Attributes:",c.attributes),console.log("   Geometry type:",null===(i=c.geometry)||void 0===i?void 0:i.type);let u=c.attributes;try{const e=a.objectIdField||"FID",t=c.attributes[e];console.log("\u{1f50d} Querying full feature by OID:",t);const r=yield a.queryFeatures({objectIds:[t],outFields:["*"],returnGeometry:!1});r.features.length>0?(u=r.features[0].attributes,console.log("\u2705 Full feature attributes:",u)):console.log("\u274c No additional attributes found via query.")}catch(e){console.error("\u26a0\ufe0f Query failed:",e)}const d=new r.default({geometry:c.geometry,symbol:{type:"simple-marker",color:[255,0,0,.6],outline:{color:[255,255,255],width:2}}});t.graphics.removeAll(),t.graphics.add(d),l({attributes:u,layerTitle:a.title,geometry:c.geometry})}catch(e){console.error("\u26a0\ufe0f Error during hitTest:",e)}}))))}))}}),c&&(0,e.jsx)("div",{css:{flex:"1",display:"flex",flexDirection:"column",minHeight:"0"}},(0,e.jsx)("div",{css:{border:"1px solid #e1e1e1",borderRadius:"8px",background:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",height:"400px"}},(0,e.jsx)("h5",{css:{margin:0,fontSize:"18px",fontWeight:600,color:"#1a1a1a",background:"white",padding:"16px",borderBottom:"1px solid #eee",flexShrink:0}},c.attributes.Organization_name||"Unnamed Feature"),(0,e.jsx)("div",{css:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{background:"#c1c1c1",borderRadius:"3px","&:hover":{background:"#a8a8a8"}}}},(0,e.jsx)("div",{css:{marginBottom:"4px"}},(0,e.jsx)("p",{css:{margin:"0 0 4px 0",fontSize:"13px",color:"#555"}},c.attributes.Physical_Address||c.attributes.Street_Address||"Address not available"),(0,e.jsx)("p",{css:{margin:"0",fontSize:"13px",fontWeight:"600",color:p(c.attributes.Operating_Hours).isOpen?"#388e3c":"#d32f2f"}},p(c.attributes.Operating_Hours).text)),c.attributes.Operating_Hours&&(0,e.jsx)("div",{css:{fontSize:"12px",color:"#666",background:"#f8f9fa",borderRadius:"4px",padding:"6px 8px"}},(0,e.jsx)("strong",null,"Hours:")," ",c.attributes.Operating_Hours),(0,e.jsx)("div",{css:{border:"1px solid #eee",borderRadius:"8px",padding:"12px",background:"#fafafa"}},(0,e.jsx)("div",{css:{fontSize:"12px",color:"#777",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px",fontWeight:"600"}},"Services Offered"),(0,e.jsx)("ul",{css:{margin:"0",paddingLeft:"18px",listStyleType:"disc",fontSize:"13px"}},(e=>{if(!e||""===e.trim())return["No services listed"];const t=e.split(/[,;]/).map((e=>e.trim())).filter((e=>""!==e));return t.length>0?t:["No services listed"]})(c.attributes.ServicesOffered).map(((t,r)=>{let o=t.replace(/\b(e\.?g\.?)\b/gi,"").replace(/[\u2013\-\.]/g," ").replace(/\s+/g," ").trim();const i=["and","or","of","the"];return o=o.toLowerCase().split(" ").map(((e,t)=>t>0&&i.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1))).join(" "),(0,e.jsx)("li",{key:r,css:{margin:"4px 0",lineHeight:"1.4",color:"No Services Listed"===o?"#999":"#333"}},o)})))),(0,e.jsx)("div",{css:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"13px"}},c.attributes.Languages_Supported_&&(0,e.jsx)("div",{css:{background:"#f8f9fa",padding:"8px",borderRadius:"4px"}},(0,e.jsx)("strong",null,"Languages:")," ",c.attributes.Languages_Supported_),c.attributes.Immigration_Status_Supported&&(0,e.jsx)("div",{css:{background:"#f8f9fa",padding:"8px",borderRadius:"4px"}},(0,e.jsx)("strong",null,"Supports:")," ",c.attributes.Immigration_Status_Supported),c.attributes.Price&&(0,e.jsx)("div",{css:{background:"#f8f9fa",padding:"8px",borderRadius:"4px"}},(0,e.jsx)("strong",null,"Cost:")," ",c.attributes.Price),c.attributes.Physical_Accessibility&&(0,e.jsx)("div",{css:{background:"#f8f9fa",padding:"8px",borderRadius:"4px"}},(0,e.jsx)("strong",null,"Accessibility:")," ",c.attributes.Physical_Accessibility),c.attributes.Organization_Description&&(0,e.jsx)("div",{css:{background:"#f8f9fa",padding:"8px",borderRadius:"4px",fontStyle:"italic"}},(0,e.jsx)("strong",null,"Description:")," ",c.attributes.Organization_Description))),(()=>{var t;let r=(null===(t=c.attributes.Website)||void 0===t?void 0:t.trim())||"",o=!1;if(r&&"N/A"!==r&&"null"!==r&&"-"!==r){/^https?:\/\//i.test(r)||(r="https://"+r);try{new URL(r),o=!0}catch(e){o=!1}}return(0,e.jsx)("div",{css:{position:"sticky",bottom:0,background:"white",paddingTop:"8px",marginTop:"auto",display:"flex",justifyContent:"center"}},(0,e.jsx)("a",{href:o?r:void 0,target:o?"_blank":void 0,rel:o?"noopener noreferrer":void 0,css:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",width:"90%",padding:"10px",background:o?"#0078d7":"#ccc",color:o?"white":"#666",borderRadius:"6px",textDecoration:"none",fontSize:"13px",fontWeight:"500",transition:"all 0.2s ease",cursor:o?"pointer":"not-allowed",border:"none","&:hover":o?{background:"#005fa3",color:"#e6f2ff",boxShadow:"0 2px 6px rgba(0,0,0,0.15)",textDecoration:"none"}:{},"&:active":o?{background:"#004f8a",transform:"scale(0.98)"}:{}},onClick:e=>{o||e.preventDefault()}},o?"View Website":"Website Not Available"))})(),c.attributes.Contact_Info&&(0,e.jsx)("div",{css:{fontSize:"12px",color:"#666",textAlign:"center",padding:"8px 0 0 0",borderTop:"1px solid #eee",marginTop:"8px",marginBottom:"8px"}},(0,e.jsx)("strong",null,"Contact:")," ",(0,e.jsx)("a",{href:`mailto:${c.attributes.Contact_Info}`,css:{color:"#007bff",textDecoration:"none","&:hover":{textDecoration:"underline"}}},c.attributes.Contact_Info)))))}function a(e){n.p=e}})(),s})())}}}));